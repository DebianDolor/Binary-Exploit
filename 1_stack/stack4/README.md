

# Analysis

* We are given with the below source code:

    ![image.png](./image.png)

* Try some random inputs:

    ![image-1.png](./image-1.png)

* Ok, just like <span style="color:red">*stack3*</span>, nothing is shown. But unlike <span style="color:red">*stack3*</span> there is no function pointer variable we could overwrite! 

* Our goal is still to execute <span style="color:red">*win()*</span>.

# Exploit

* Let me do a little recall. When a function is called, the address where we want to return to, will be pushed on the stack. And when <span style="color:red">*ret*</span> is called, it will pop this address off the stack. Thus jumping back where we came from. 

* So instead of overflowing a local variable, we can overflow the return pointer. And when main would return, it will read the wrong value and jump there instead! (here we want to jump to <span style="color:red">*win()*</span>)

* So lets open GDB and find <span style="color:red">*win()*</span>'s address:

    ![image-2.png](./image-2.png)

* So this is the address we want to jump to. There are several approaches to this. The easy way is just to set $EIP to this address. Then it will call <span style="color:red">*win()*</span>:

    ![image-4.png](./image-4.png)

* But that's not what we're trying to do here. We're trying to write an exploit code. So lets do that.

* There is a cool trick to know how many bytes it takes to overflow a variable (return pointer as well). I'll write a simple python code:

    ![image-5.png](./image-5.png)

* This is the padding we will be using. We will see what stored in EBP and EIP after run the program with this. Thus know how many bytes we need. (I put the result in /exp).

    ![image-6.png](./image-6.png)

* It stops at 0x74747474, which is "tttt". If you look at the register, you'll see:

    ![image-7.png](./image-7.png)

* EBP is 0x73737373 ("ssss"). So I'll modify the exploit code:

    ![image-8.png](./image-8.png)

* Now run it:

    ![image-9.png](./image-9.png)

# Bugs

* Same as previous level, the bug is at the <span style="color:red">*gets*</span> function.


    





