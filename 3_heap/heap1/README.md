# Analysis

* We are given with the below source code:

    ![image.png](./image.png)

* Lets try some random inputs:

    ![image-1.png](./image-1.png)

*  We have a buffer overflow on the <span style="color:red">*name*</span> buffer that is allocated on the heap.

    - Just like the stack, heap memory is allocated contiguously. 
    
    - This means that if we write past the buffer, we will be overwriting another data structure.

* Our goal, still, is to execute the <span style="color:red">*winner*</span> function.

# Exploit

* Load this in GDB:

    ![image-2.png](./image-2.png)

* Set breakpoints at each of the last 3 malloc functions (skip the first one), we examine the value of EAX to see the memory address of every components in the  <span style="color:red">*internet*</span> struct:

    ![image-3.png](./image-3.png)

    - i1 at 0x0804a008 –> i1.priority at 0x0804a008 (size 4) –> i1.name at 0x0804a00c (size 4) —-> memory area pointed by i1.name at 0x0804a018.

    ![image-4.png](./image-4.png)

    - Similarly, i2 at 0x0804a028 –> i2.priority at 0x0804a028 (size 4) –> i2.name at 0x0804a02c (size 4) —-> memory area pointed by i2.name at 0x0804a038.

* Okay here comes the idea: we can overwrite argv[1] with the address of <span style="color:red">*puts*</span> and argv[2] with the address of <span style="color:red">*winner*</span>. So when it gets executed, we can execute another function instead. Thats nice, we can write any arbitrary content (argv[2]) in any arbitrary address (controlled by argv[1]).

* Lets find the memory address of <span style="color:red">*winner*</span> and <span style="color:red">*puts*</span>:

    ![image-6.png](./image-6.png)
    ![image-5.png](./image-5.png)

* Again, we want to find how many bytes we need for the padding. 0x0804a02c - 0x0804a018 = 0x14 = 20.

* Boom:

    ![image-7.png](./image-7.png)

# The bugs:

* This level is vulnerable because we can pass as many bytes as we want via the <span style="color:red">*name[64]*</span> and the <span style="color:red">*strcpy*</span>:

    ![image-8.png](./image-8.png)




